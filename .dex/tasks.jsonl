{"id":"2knyjk3l","parent_id":"enkgztol","name":"Info panel, controls, and move list","description":"Build the side panel UI: puzzle info, timer display, analysis lines, move list, and action buttons.\n\n## What\nCreate the right-side panel (desktop) / bottom section (mobile) containing all non-board UI: puzzle metadata, timer, Stockfish analysis lines, recorded move list, and the Next/Stats/Settings buttons. This is the 'command center' of the puzzle experience.\n\n## Design Reference\n- Desktop (desktop.png): Panel to the right of the board with puzzle info at top, timer, analysis section, moves section, and bottom action bar\n- Mobile (mobile.png): Info below board with tabbed Analysis/Moves sections\n\n## Implementation\n\n### 1. PuzzleInfo Component (src/components/PuzzleInfo.tsx)\n- Large puzzle number: '42' with '/ 4462' in smaller text\n- Puzzle type in accent color: 'Mate in 2' (gold/yellow per screenshots)\n- Side to move: '• White to move' (or status text: 'Solved ✓' / 'Failed')\n- Status changes color: green for solved, red for failed\n\n### 2. Timer Component (src/components/Timer.tsx)\n- Large monospace MM:SS display (01:23 format per screenshots)\n- 'ELAPSED' label below during play\n- On solve: timer turns green, label changes to 'SOLVE TIME'\n- On fail+complete: timer turns red, label changes to 'TIME'\n- Timer size increases in complete states (celebration/emphasis per states_2.png)\n\n### 3. Analysis Panel\n- Header: 'ANALYSIS' with ON/OFF toggle (green 'ON' text per desktop.png)\n- Show top 2 Stockfish evaluation lines:\n  - Format: '#2 Qxg7+ Kxg7 Bxf6#' with depth indicator (d32)\n  - Mate scores in green (#2), centipawn scores in yellow (+8.2)\n- On checkmate: show '#0 Checkmate' badge (per states_2.png)\n- Only visible when engine is enabled\n\n### 4. Move List\n- Header: 'MOVES'\n- Numbered move pairs: '1. Qxg7+ Kxg7' (user move, opponent response)\n- Placeholder for next move: dashed border 'Your move...' (per desktop.png)\n- Correct moves: default/green text\n- Wrong moves: red text with strikethrough (e.g., 'Bf4?' per states screenshots)\n- Move annotations: '?' for wrong moves, '+' for check, '#' for checkmate\n\n### 5. Action Bar (bottom)\n- Settings icon button (gear icon, leftmost)\n- 'Stats' button (center)\n- 'Next →' button (rightmost)\n  - Disabled/muted during active play\n  - Enabled + highlighted (green) after checkmate\n  - Full-width on mobile (per mobile.png)\n\n### 6. Tabbed Layout (Mobile)\n- 'ANALYSIS' and 'MOVES' as tab headers (per mobile.png)\n- Default to MOVES tab\n- Active tab has underline/highlight indicator\n- Tab content scrollable if moves exceed visible area\n\n## Done When\n- Puzzle info displays correctly (number, type, side to move)\n- Timer counts up in MM:SS format, stops and changes color on completion\n- Analysis shows Stockfish evaluation lines when engine is on\n- Move list records and displays all moves with correct annotations\n- Wrong moves shown in red with strikethrough\n- Next button enables after checkmate\n- Action bar has settings, stats, and next buttons\n- Mobile view uses tabbed layout for analysis/moves","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:06:51.870Z","updated_at":"2026-02-12T01:07:55.778Z","started_at":null,"completed_at":null,"blockedBy":["rapakozx","tucqhy85"],"blocks":["ihqhbnda"],"children":[]}
{"id":"3qkp6mb4","parent_id":"5v6xhkg5","name":"TypeScript types and Zod schemas","description":"Create src/types/index.ts with: PuzzleData schema/type (validated from JSON), ParsedMove type, PuzzleState type, AppState type, GamePhase union type, DerivedStats type. Use Zod schemas as single source of truth for runtime validation + static types.","priority":1,"completed":true,"result":"Created src/types/index.ts with Zod schemas for PuzzleData and ProblemsFile (runtime validation + inferred types). Defined: SideToMove, PuzzleType (const arrays + inferred unions), ParsedMove, GamePhase, PuzzleStatus, PuzzleState, AppState, AppSettings, DerivedStats. Zero use of 'any' or 'unknown'. Compiles cleanly under strict mode.","metadata":null,"created_at":"2026-02-12T02:23:36.639Z","updated_at":"2026-02-12T02:27:32.519Z","started_at":"2026-02-12T02:27:32.518Z","completed_at":"2026-02-12T02:27:32.519Z","blockedBy":[],"blocks":[],"children":[]}
{"id":"5v6xhkg5","parent_id":"enkgztol","name":"Project scaffolding, types, and data layer","description":"Set up the Vite + React + TypeScript project and establish the data foundation.\n\n## What\nBootstrap the project with all required dependencies and create the core data layer that everything else builds on: TypeScript types, puzzle data loading/parsing, and localStorage persistence.\n\n## Implementation\n\n### 1. Project Setup\n- `npm create vite@latest . -- --template react-ts`\n- Install dependencies: @lichess-org/chessground, chess.js, stockfish (WASM lite variant)\n- Configure tsconfig.json, vite.config.ts\n- Set up file structure per spec (src/components/, src/hooks/, src/lib/, src/types/, src/styles/)\n\n### 2. TypeScript Types (src/types/index.ts)\n- PuzzleData interface (problemid, first, type, fen, moves - matching JSON source)\n- PuzzleState interface (status: unattempted|success|fail, timeMs, attempts)\n- AppState interface (currentPuzzleId, puzzles record, settings)\n- GamePhase enum (LOADING, PLAYING, VALIDATING, OPPONENT_TURN, COMPLETE)\n\n### 3. Puzzle Data (src/lib/puzzles.ts)\n- Fetch problems.json from https://github.com/denialromeo/4462-chess-problems\n- Bundle in public/problems.json for offline capability\n- parseMove() utility to convert 'f6-g7' format to {from, to, promotion?}\n- loadPuzzles() function that returns typed puzzle array\n\n### 4. Persistence (src/hooks/useLocalStorage.ts)\n- useLocalStorage hook for reading/writing AppState\n- Derived stats computation (total attempted, solved, success rate, avg time)\n- Initialize default state for new users (currentPuzzleId: 1, empty puzzles record)\n- Handle schema migrations if state shape changes\n\n## Done When\n- `npm run dev` starts without errors\n- Types compile cleanly\n- Puzzle data loads and is accessible (4462 puzzles)\n- localStorage round-trips AppState correctly\n- parseMove handles standard moves and promotions (e.g., 'f7-f8q')","priority":1,"completed":true,"result":"Project fully scaffolded and data layer complete.\n\n## Setup\n- Vite 7.3 + React 19 + TypeScript 5.9 (strict: noUncheckedIndexedAccess, exactOptionalPropertyTypes, verbatimModuleSyntax)\n- Vitest 4.0 with happy-dom, @testing-library/react\n- Path aliases (@/ → src/)\n- Dependencies: zod (runtime validation), chess.js, @lichess-org/chessground\n\n## Types (src/types/index.ts)\n- Zod schemas for PuzzleData and ProblemsFile (runtime + static type safety)\n- Const-array-derived unions for SideToMove, PuzzleType, GamePhase, PuzzleStatus\n- Interfaces: ParsedMove, PuzzleState, AppState, AppSettings, DerivedStats\n- Zero use of any/unknown\n\n## Puzzle data layer (src/lib/puzzles.ts)\n- parseMove/parseMoves: converts 'f6-g7' and 'f7-f8q' formats with validation\n- mateDepthFromType: maps puzzle type to depth\n- loadPuzzles: fetches + Zod-validates problems.json, caches in memory\n- getPuzzleById: lookup by problemid\n\n## Persistence (src/lib/persistence.ts + src/hooks/useAppState.ts)\n- Schema-versioned localStorage with migration support\n- Pure functions: loadAppState, saveAppState, clearAppState, computeStats\n- React hook using useSyncExternalStore for tear-free reads\n- Graceful recovery from corrupted/missing data\n\n## Verification\n- tsc --noEmit: clean\n- vite build: clean (193KB gzipped 60KB)\n- 30 tests passing (18 puzzle + 12 persistence)\n- npm run dev starts without errors","metadata":null,"created_at":"2026-02-12T01:05:24.799Z","updated_at":"2026-02-12T02:27:48.811Z","started_at":"2026-02-12T02:27:48.810Z","completed_at":"2026-02-12T02:27:48.811Z","blockedBy":[],"blocks":["69zaeor3","rapakozx","tucqhy85"],"children":["zjpda3at","3qkp6mb4","x43emd2o","u1ubrxlt"]}
{"id":"69zaeor3","parent_id":"enkgztol","name":"Stockfish engine integration","description":"Integrate Stockfish WASM engine running in a Web Worker for move validation and opponent play.\n\n## What\nCreate the Stockfish service layer that powers two critical flows: (1) validating whether the user's move maintains a forced mate, and (2) playing the opponent's best defense after a correct user move.\n\n## Why\nThe engine is central to the puzzle experience. It determines correctness by checking if the user's move still leads to mate in N moves, and it plays realistic opponent responses (best defense) rather than scripted lines.\n\n## Implementation\n\n### 1. Stockfish Worker (src/lib/stockfish.ts)\n- Load stockfish WASM ('lite' variant ~7MB for mobile perf) in a Web Worker\n- UCI protocol initialization: send 'uci', wait for 'uciok', send 'isready', wait for 'readyok'\n- Create a promise-based API wrapping the postMessage/onmessage pattern\n- Key methods:\n  - analyze(fen, depth): returns {bestMove, score, mateIn}\n  - getBestMove(fen): returns the best move string\n  - stop(): cancel ongoing analysis\n  - isReady(): check engine state\n\n### 2. UCI Response Parsing\n- Parse 'bestmove e2e4' responses\n- Parse 'info depth N score mate M' for mate detection\n- Parse 'info depth N score cp C' for centipawn evaluation\n- Extract PV (principal variation) lines for the analysis display\n\n### 3. useStockfish Hook (src/hooks/useStockfish.ts)\n- Manages engine lifecycle (init, ready state, cleanup on unmount)\n- Exposes: validateMove(fen, requiredMateIn) → {isCorrect, bestMove, evaluation}\n- Exposes: getOpponentMove(fen) → bestMove string\n- Loading state while engine initializes\n- Error handling for WASM load failures (fallback to non-engine mode)\n\n### 4. Move Validation Logic\n- After user moves, send new FEN to engine at depth 15\n- Check if 'score mate N' exists where N ≤ required moves remaining\n- If mate found → move is correct\n- If no forced mate → move is incorrect, puzzle marked failed\n- Edge case: user delivers checkmate directly (no engine needed, chess.js detects it)\n\n## Done When\n- Engine loads in Web Worker without blocking main thread\n- analyze() returns correct mate evaluations for known positions\n- Opponent best-move responses are reasonable (defends well)\n- Engine gracefully handles rapid position changes (stop previous analysis)\n- Fallback mode works when engine fails to load","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:05:43.162Z","updated_at":"2026-02-12T01:07:55.110Z","started_at":null,"completed_at":null,"blockedBy":["5v6xhkg5"],"blocks":[],"children":[]}
{"id":"enkgztol","parent_id":null,"name":"Zugzwang — Chess Puzzle Trainer","description":"# Zugzwang — Chess Puzzle Trainer\n\n## Overview\n\nZugzwang is a web-based chess puzzle trainer featuring 4,462 puzzles from the Susan Polgar collection. Users progress linearly through puzzles, playing out full checkmate sequences against Stockfish's best defense.\n\n---\n\n## Core Experience\n\n### Puzzle Flow\n\n1. User loads puzzle (FEN position displayed on board)\n2. Prompt shows \"White to move\" / \"Black to move\" and puzzle type (\"Mate in 2\")\n3. User makes a move\n4. **If correct**: Stockfish plays best defense, user continues until checkmate\n5. **If incorrect**: Puzzle marked as **failed**, but user can continue playing to understand the position\n6. **On checkmate**: Puzzle complete; subtle success indicator shown only if solved correctly\n7. User clicks \"Next\" to advance\n\n### Validation Logic\n\n- **Engine enabled**: Stockfish analyzes position to verify user's move leads to mate in required moves\n- **Engine disabled**: Validate against stored solution moves from JSON (first move only, then auto-play sequence)\n\n### Feedback Philosophy\n\n- Minimal, non-intrusive\n- Success: subtle visual confirmation (e.g., brief green glow, soft sound)\n- Failure: no explicit \"wrong\" message—puzzle silently marked failed, user discovers why through continued play\n\n---\n\n## Data Source\n\n**Repository**: https://github.com/denialromeo/4462-chess-problems\n\n**JSON structure**:\n```json\n{\n  \"problemid\": 1,\n  \"first\": \"White to Move\",\n  \"type\": \"Mate in One\",\n  \"fen\": \"3q1rk1/5pbp/5Qp1/8/8/2B5/5PPP/6K1 w - - 0 1\",\n  \"moves\": \"f6-g7\"\n}\n```\n\n**Fields**:\n- `problemid`: Sequential ID (1–4462)\n- `first`: Who moves first\n- `type`: Puzzle type (Mate in One, Mate in Two, etc.)\n- `fen`: Board position in FEN notation\n- `moves`: Solution moves in `from-to` format (e.g., `f6-g7`, `f7-f8q` for promotion)\n\n---\n\n## Tech Stack\n\n| Layer | Technology | Purpose |\n|-------|------------|---------|\n| Framework | React 18+ | UI components |\n| Build | Vite | Fast dev/build |\n| Language | TypeScript | Type safety |\n| Board UI | @lichess-org/chessground | Chess board rendering, drag/drop, touch |\n| Chess Logic | chess.js | Move validation, FEN parsing, game state |\n| Engine | stockfish (npm) | WASM Stockfish for move validation & opponent play |\n| Hosting | Vercel | Free static hosting |\n| Persistence | localStorage | Progress, stats |\n\n### Key Libraries\n\n**@lichess-org/chessground**\n- Lichess's production chess UI\n- 10KB gzipped, no dependencies\n- Mobile/touch ready\n- GPL-3.0 license\n\n**chess.js**\n- Move generation and validation\n- FEN/PGN parsing\n- Game state management (check, checkmate, draw)\n\n**stockfish (npm)**\n- Chess.com's WASM build\n- Use \"lite\" variant (~7MB) for mobile performance\n- Runs in Web Worker\n\n---\n\n## Persistence (localStorage)\n\n### Schema\n\n```typescript\ninterface PuzzleState {\n  status: 'unattempted' | 'success' | 'fail';\n  timeMs: number | null;      // Time to solve (ms)\n  attempts: number;           // Number of attempts\n}\n\ninterface AppState {\n  currentPuzzleId: number;    // 1-indexed\n  puzzles: Record<number, PuzzleState>;\n  settings: {\n    engineEnabled: boolean;\n  };\n}\n```\n\n### Derived Stats (computed on read)\n\n- Total puzzles attempted\n- Total solved correctly\n- Success rate (%)\n- Average solve time\n- Current puzzle position (e.g., \"42 / 4462\")\n\n---\n\n## UI Components\n\n### Main View (Single Page)\n\nSee images in the folder\n- @desktop.png\n- @mobile.png\n\nVarious states (feedback)\n- @states_1.png\n- @states_2.png\n\n### Components\n\n1. **PuzzleInfo**\n   - Puzzle number + total (\"42 / 4462\")\n   - Puzzle type (\"Mate in 2\")\n   - Who moves (\"White to move\")\n\n2. **ChessBoard**\n   - Chessground instance\n   - Auto-orients based on `first` field (white at bottom if white to move)\n   - Legal move highlighting\n   - Drag/drop + click-click move input\n\n3. **Timer**\n   - Starts when puzzle loads\n   - Stops on checkmate\n   - Displays MM:SS format\n\n4. **NextButton**\n   - Hidden during active puzzle\n   - Appears after checkmate\n   - Advances to next puzzle\n\n5. **SettingsModal**\n   - Engine on/off toggle\n   - (Future: board theme, sound, etc.)\n\n6. **StatsView**\n   - Accessible via icon/link\n   - Shows aggregate statistics\n   - Could be modal or slide-out panel\n\n### Responsive Behavior\n\n- **Desktop**: Board ~500-600px, info beside or above\n- **Tablet**: Board fills width with padding, info above\n- **Mobile**: Board fills width, info stacked above, controls below\n\n---\n\n## Stockfish Integration\n\n### Initialization\n\n```typescript\n// Load engine in Web Worker\nconst stockfish = new Worker('stockfish.js');\n\nstockfish.onmessage = (e) => {\n  // Parse UCI responses\n};\n\nstockfish.postMessage('uci');\nstockfish.postMessage('isready');\n```\n\n### Move Validation Flow\n\n1. User makes move\n2. Apply move to chess.js board\n3. Send position to Stockfish: `position fen <new_fen>`\n4. Request analysis: `go depth 15`\n5. Parse `bestmove` and `score mate N` from output\n6. If mate in ≤ required moves exists → move is correct\n7. If no forced mate → move is incorrect (mark puzzle failed)\n\n### Opponent Response\n\n1. After valid user move (not checkmate)\n2. Stockfish already computed best defense\n3. Apply best move to board\n4. Animate piece movement\n5. User's turn again\n\n### Fallback (Engine Disabled)\n\n- Validate first move against `moves` field in JSON\n- Auto-play opponent responses from solution\n- Less flexible but works offline/low-power devices\n\n---\n\n## Move Format Conversion\n\nThe JSON uses `from-to` format (e.g., `f6-g7`). Need to convert:\n\n```typescript\nfunction parseMove(move: string): { from: string; to: string; promotion?: string } {\n  // \"f6-g7\" → { from: \"f6\", to: \"g7\" }\n  // \"f7-f8q\" → { from: \"f7\", to: \"f8\", promotion: \"q\" }\n  const [from, toRaw] = move.split('-');\n  const promotion = toRaw.length > 2 ? toRaw[2] : undefined;\n  const to = toRaw.slice(0, 2);\n  return { from, to, promotion };\n}\n```\n\n---\n\n## State Machine\n\n```\n┌──────────────┐\n│   LOADING    │ ← Initial state, loading puzzle data\n└──────┬───────┘\n       │\n       ▼\n┌──────────────┐\n│   PLAYING    │ ← User's turn, timer running\n└──────┬───────┘\n       │ User moves\n       ▼\n┌──────────────┐\n│  VALIDATING  │ ← Engine analyzing move\n└──────┬───────┘\n       │\n       ├─── Valid + Checkmate ───▶ COMPLETE (success)\n       │\n       ├─── Valid + Not Mate ───▶ OPPONENT_TURN\n       │\n       └─── Invalid ───▶ PLAYING (puzzle marked failed)\n\n┌──────────────┐\n│OPPONENT_TURN │ ← Stockfish plays, animating\n└──────┬───────┘\n       │\n       ▼\n┌──────────────┐\n│   PLAYING    │\n└──────────────┘\n\n┌──────────────┐\n│   COMPLETE   │ ← Checkmate delivered\n└──────┬───────┘\n       │ User clicks Next\n       ▼\n┌──────────────┐\n│   LOADING    │ ← Load next puzzle\n└──────────────┘\n```\n\n---\n\n## File Structure\n\n```\nzugzwang/\n├── public/\n│   └── problems.json          # Puzzle data (fetched at runtime or bundled)\n├── src/\n│   ├── main.tsx               # Entry point\n│   ├── App.tsx                # Main app component\n│   ├── components/\n│   │   ├── Board.tsx          # Chessground wrapper\n│   │   ├── PuzzleInfo.tsx     # Puzzle metadata display\n│   │   ├── Timer.tsx          # Solve timer\n│   │   ├── NextButton.tsx     # Navigation\n│   │   ├── Settings.tsx       # Settings modal\n│   │   └── Stats.tsx          # Statistics view\n│   ├── hooks/\n│   │   ├── useStockfish.ts    # Engine management\n│   │   ├── usePuzzle.ts       # Puzzle state management\n│   │   ├── useTimer.ts        # Timer logic\n│   │   └── useLocalStorage.ts # Persistence\n│   ├── lib/\n│   │   ├── chess.ts           # chess.js wrapper utilities\n│   │   ├── stockfish.ts       # Stockfish UCI communication\n│   │   └── puzzles.ts         # Puzzle data loading/parsing\n│   ├── types/\n│   │   └── index.ts           # TypeScript interfaces\n│   └── styles/\n│       ├── chessground.css    # Chessground base styles\n│       └── app.css            # App styles\n├── index.html\n├── package.json\n├── tsconfig.json\n├── vite.config.ts\n└── README.md\n```\n\n---\n\n## Future Considerations (Out of Scope)\n\n- User accounts / cloud sync\n- Leaderboards\n- Spaced repetition for failed puzzles\n- Puzzle filtering by type/difficulty\n- Custom puzzle sets\n- Board themes / piece sets\n- Sound effects\n- Keyboard shortcuts\n- Share puzzle links\n\n---\n\n## Open Questions\n\n1. **Bundle vs fetch puzzles**: Include `problems.json` in bundle (~500KB) or fetch at runtime?\n   - Recommendation: Bundle for offline capability and faster initial load\n\n2. **Stockfish depth**: What analysis depth for validation?\n   - Recommendation: depth 15 (fast enough, accurate for mate puzzles)\n\n3. **Success animation**: What exactly? Options:\n   - Brief green border glow\n   - Checkmark icon\n   - Confetti (maybe too much)\n   - Subtle sound\n\n---\n\n## License\n\nGPL-3.0 (required by Chessground dependency)\n","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:04:48.865Z","updated_at":"2026-02-12T01:04:48.865Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":["5v6xhkg5","69zaeor3","rapakozx","tucqhy85","2knyjk3l","ihqhbnda","orsmxt2t"]}
{"id":"ihqhbnda","parent_id":"enkgztol","name":"Feedback states and visual polish","description":"Implement the four visual feedback states: correct move, incorrect move, puzzle solved, and failed-but-completed.\n\n## What\nAdd the visual feedback layer that communicates puzzle outcomes through board border glows, toast messages, color changes, and move annotations. This is what makes the puzzle experience feel responsive and satisfying.\n\n## Design Reference\n- states_1.png: Correct move (green glow + toast) and Incorrect move (red glow + toast)\n- states_2.png: Puzzle Solved (green border, green timer) and Failed but Completed (red border, red timer)\n- mobile.png: Same states adapted to mobile layout\n\n## Implementation\n\n### 1. Board Glow / Border Feedback\n- Correct move: board border briefly pulses green, then returns to default\n- Incorrect move: board border briefly pulses red, then persists subtly\n- Puzzle solved (complete + no failures): board has persistent green border\n- Failed but completed: board has persistent red border\n- CSS transitions for smooth glow animation (~500ms pulse)\n\n### 2. Toast Notifications\n- Correct move: '✓ Correct! Opponent plays...' in green-bordered toast (per states_1.png)\n- Incorrect move: '✗ Not the best move. Keep playing to explore.' in red-bordered toast\n- Toasts appear between timer and move list\n- Auto-dismiss after ~2-3 seconds, or on next action\n- Minimal animation (fade in/out)\n\n### 3. Puzzle Complete States (per states_2.png)\n**Solved successfully:**\n- PuzzleInfo status: 'Solved ✓' in green (replaces 'White to move')\n- Timer: larger size, green color, label 'SOLVE TIME'\n- Analysis shows '#0 Checkmate'\n- All moves in green\n- Next button highlighted green\n\n**Failed but completed (reached checkmate after wrong move):**\n- PuzzleInfo status: 'Failed' in red\n- Timer: larger size, red color, label 'TIME'\n- Analysis shows '#0 Checkmate'\n- Wrong moves in red with strikethrough, correct moves in default\n- Next button highlighted green\n\n### 4. Move Annotations in Move List\n- Correct user moves: green text (or default white)\n- Wrong user moves: red text, strikethrough, '?' annotation (e.g., 'Bf4?')\n- Checkmate move: '#' suffix (e.g., 'Bxf6#')\n- Check move: '+' suffix (e.g., 'Qxg7+')\n\n### 5. Transition Animations\n- State transitions should feel smooth, not jarring\n- Board border color changes with CSS transition\n- Timer color/size change with transition\n- Toast fade in (200ms) and fade out (300ms)\n- Next button enable animation (opacity/color transition)\n\n## Done When\n- Correct move shows green board pulse + toast message\n- Incorrect move shows red board pulse + toast + marks puzzle failed\n- Solved puzzle shows persistent green border, green timer, 'Solved ✓'\n- Failed-but-completed shows persistent red border, red timer, 'Failed'\n- Wrong moves display as red strikethrough in move list\n- All transitions are smooth (no visual jumps)\n- Feedback matches the states_1.png and states_2.png designs","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:07:11.810Z","updated_at":"2026-02-12T01:07:55.946Z","started_at":null,"completed_at":null,"blockedBy":["2knyjk3l"],"blocks":["orsmxt2t"],"children":[]}
{"id":"orsmxt2t","parent_id":"enkgztol","name":"Stats, settings, responsive layout, and deployment","description":"Build the stats view, settings modal, responsive layout across breakpoints, and deploy to Vercel.\n\n## What\nComplete the app with the remaining UI features (stats aggregation, settings toggle), make it fully responsive matching the desktop/mobile mockups, and deploy to Vercel for production hosting.\n\n## Design Reference\n- Desktop (desktop.png): Board left (~60%), panel right (~40%), dark background\n- Mobile (mobile.png): Board full-width at top, info below, tabbed sections, full-width buttons\n- Overall theme: dark background (#1a1a1a-ish), dark card panels, gold/amber accents, green/red feedback colors\n\n## Implementation\n\n### 1. StatsView Component (src/components/Stats.tsx)\n- Modal or slide-out panel (accessible via 'Stats' button in action bar)\n- Display derived stats from localStorage:\n  - Total puzzles attempted (count of non-unattempted)\n  - Total solved correctly (count of success)\n  - Success rate (solved / attempted as %)\n  - Average solve time (mean of timeMs for solved puzzles, formatted MM:SS)\n  - Current position: 'Puzzle 42 / 4462'\n- Clean dark modal matching app theme\n- Close button or click-outside to dismiss\n\n### 2. SettingsModal Component (src/components/Settings.tsx)\n- Accessible via gear icon in action bar\n- Engine on/off toggle switch\n  - When off: validation uses stored solution moves (fallback mode)\n  - When on: validation uses Stockfish analysis\n  - Persisted to AppState.settings.engineEnabled\n- Dark modal matching app theme\n- Future: board theme, sound toggles (out of scope, but leave room)\n\n### 3. Responsive Layout (src/App.tsx, src/styles/app.css)\n**Desktop (>768px):**\n- Flexbox row: board on left, info panel on right\n- Board ~500-600px\n- Panel takes remaining width\n- Min padding around edges\n\n**Tablet (481-768px):**\n- Board fills width with padding\n- Info panel below board\n- Analysis/Moves side-by-side or tabbed\n\n**Mobile (≤480px):**\n- Board fills viewport width (minus small padding)\n- Puzzle info + timer in compact row below board\n- Tabbed 'ANALYSIS' / 'MOVES' sections\n- Full-width Next button\n- Settings/Stats as small icons in footer bar\n\n### 4. Global Styles (src/styles/app.css)\n- Dark theme: background #1a1a1a, panels #2a2a2a, borders #3a3a3a\n- Typography: monospace for timer/eval, sans-serif for UI text\n- Color palette:\n  - Gold/amber: puzzle type, accent text (#d4a017-ish)\n  - Green: correct/solved feedback (#4caf50)\n  - Red: incorrect/failed feedback (#f44336)\n  - White: primary text\n  - Gray: secondary text, labels\n- Import and customize chessground CSS to match dark theme\n\n### 5. Vercel Deployment\n- Add vercel.json if needed (Vite builds to dist/ by default)\n- Ensure public/problems.json is included in build\n- Verify Stockfish WASM files are served correctly (proper MIME types, CORS headers)\n- Test production build: npm run build && npm run preview\n\n## Done When\n- Stats modal shows accurate aggregated data\n- Settings toggle switches between engine/fallback modes\n- Desktop layout matches desktop.png (board left, panel right)\n- Mobile layout matches mobile.png (stacked, tabbed, full-width buttons)\n- Smooth transitions between breakpoints\n- Dark theme applied consistently\n- Production build works on Vercel\n- Stockfish WASM loads in production (correct headers/paths)","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:07:36.280Z","updated_at":"2026-02-12T01:07:56.110Z","started_at":null,"completed_at":null,"blockedBy":["ihqhbnda"],"blocks":[],"children":[]}
{"id":"rapakozx","parent_id":"enkgztol","name":"Core puzzle state machine and game logic","description":"Implement the central game loop: state machine, puzzle lifecycle, move processing, and timer.\n\n## What\nBuild the usePuzzle hook that orchestrates the entire puzzle experience — loading puzzles, managing the state machine (LOADING → PLAYING → VALIDATING → OPPONENT_TURN → COMPLETE), processing moves through validation, and tracking solve time.\n\n## Why\nThis is the brain of the app. It connects the data layer, engine, and UI by managing all state transitions and game rules. Both engine-enabled and engine-disabled modes need to work.\n\n## Implementation\n\n### 1. State Machine (within usePuzzle hook)\nStates and transitions per spec:\n- LOADING: Fetch puzzle by ID, parse FEN, determine side to move → PLAYING\n- PLAYING: User's turn, timer running. On user move → VALIDATING\n- VALIDATING: Engine analyzing (or solution lookup). Three outcomes:\n  - Valid + checkmate → COMPLETE (success if no prior failures)\n  - Valid + not mate → OPPONENT_TURN\n  - Invalid → back to PLAYING (puzzle marked failed, user can keep exploring)\n- OPPONENT_TURN: Engine plays best defense, animate move → PLAYING\n- COMPLETE: Checkmate delivered. Show result, stop timer. On 'Next' → LOADING\n\n### 2. usePuzzle Hook (src/hooks/usePuzzle.ts)\n- Inputs: puzzle data, stockfish hook, localStorage hook\n- State: gamePhase, chess.js instance, moveHistory[], isFailed, currentFEN\n- Actions:\n  - loadPuzzle(id): reset board, parse FEN, set orientation\n  - makeMove(from, to, promotion?): process user move through validation\n  - nextPuzzle(): advance currentPuzzleId, save state, load next\n- Move history tracking: record each {userMove, opponentMove} pair with annotations\n  - Correct moves shown in green (or default)\n  - Wrong moves shown in red with strikethrough (per states screenshots)\n\n### 3. Engine-Disabled Fallback Mode\n- Validate user's first move against the 'moves' field from JSON\n- Auto-play opponent responses from the solution sequence\n- Less flexible but works offline/low-power devices\n- parseMove() to convert 'f6-g7' format\n\n### 4. Timer (src/hooks/useTimer.ts)\n- Starts when puzzle enters PLAYING state\n- Pauses during VALIDATING and OPPONENT_TURN (or keeps running — spec says stops on checkmate)\n- Stops on COMPLETE\n- Returns elapsed time in ms, formatted as MM:SS\n- Persisted to PuzzleState.timeMs on completion\n\n### 5. chess.js Integration (src/lib/chess.ts)\n- Wrapper utilities around chess.js\n- loadFen(fen): create Chess instance from FEN\n- makeMove(chess, move): apply move, return new FEN\n- isCheckmate(chess): check game end state\n- getLegalMoves(chess): for Chessground legal move highlighting\n- getSideToMove(fen): extract from FEN string\n\n## Done When\n- Full puzzle lifecycle works: load → play moves → checkmate → next\n- Engine-enabled mode: validates via Stockfish depth analysis\n- Engine-disabled mode: validates against stored solution\n- Incorrect moves mark puzzle as failed but allow continued play\n- Timer tracks solve time accurately\n- State persists to localStorage on completion\n- Move history records all moves with correct/incorrect annotations","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:06:05.805Z","updated_at":"2026-02-12T01:07:55.280Z","started_at":null,"completed_at":null,"blockedBy":["5v6xhkg5"],"blocks":["2knyjk3l"],"children":[]}
{"id":"tucqhy85","parent_id":"enkgztol","name":"Chess board component (Chessground)","description":"Build the Board component wrapping Lichess Chessground for rendering, interaction, and animation.\n\n## What\nCreate the Board.tsx component that integrates @lichess-org/chessground — the same chess UI used by Lichess in production. This handles all visual board rendering, piece drag/drop, click-to-move, legal move indicators, and animated piece movement for opponent responses.\n\n## Why\nChessground is the visual heart of the app. It needs to correctly reflect game state, respond to user input, auto-orient based on who's playing, and animate opponent moves smoothly.\n\n## Implementation\n\n### 1. Board Component (src/components/Board.tsx)\n- Mount Chessground instance into a container div\n- Configure with:\n  - fen: current position\n  - orientation: 'white' or 'black' based on puzzle's 'first' field\n  - turnColor: whose turn it is\n  - movable: { free: false, color: side to move, dests: legal moves map }\n  - draggable: { enabled: true }\n  - animation: { enabled: true, duration: 200 }\n- Event handlers:\n  - onMove(orig, dest): callback to usePuzzle.makeMove()\n  - Handle promotion: detect pawn reaching last rank, default to queen (or show picker)\n- Update Chessground config reactively when FEN/state changes\n- Cleanup on unmount (cg.destroy())\n\n### 2. Legal Move Highlighting\n- Compute legal moves from chess.js: chess.moves({ verbose: true })\n- Convert to Chessground dests format: Map<Square, Square[]>\n- Update dests on each position change\n- Disable interaction during VALIDATING and OPPONENT_TURN phases\n\n### 3. Opponent Move Animation\n- When engine returns opponent move, apply to Chessground with animation\n- Use cg.move(from, to) for animated piece movement\n- Brief delay (~300ms) before opponent moves for natural feel\n\n### 4. Board Styling\n- Import chessground base CSS\n- Board container sizing: ~500-600px desktop, full-width mobile\n- Board border that changes color for feedback states:\n  - Default: subtle dark border\n  - Correct/Solved: green border/glow (per states_1.png, states_2.png)\n  - Failed: red border/glow\n- Coordinates visible (a-h, 1-8) as shown in desktop.png\n\n### 5. Promotion Handling\n- Detect when a pawn move reaches the last rank\n- Default to queen promotion (most common in mate puzzles)\n- Optionally show a simple promotion piece picker\n\n## Done When\n- Board renders FEN positions correctly\n- Pieces are draggable and clickable for moves\n- Board auto-orients (white bottom when white to move, black bottom when black to move)\n- Legal moves shown as dots/highlights on piece selection\n- Opponent moves animate smoothly\n- Board is not interactive during engine thinking / opponent turn\n- Promotion moves work (at minimum auto-queen)","priority":1,"completed":false,"result":null,"metadata":null,"created_at":"2026-02-12T01:06:26.551Z","updated_at":"2026-02-12T01:07:55.446Z","started_at":null,"completed_at":null,"blockedBy":["5v6xhkg5"],"blocks":["2knyjk3l"],"children":[]}
{"id":"u1ubrxlt","parent_id":"5v6xhkg5","name":"LocalStorage persistence and derived stats","description":"Create src/lib/persistence.ts with pure functions: loadAppState(), saveAppState(), computeStats(). Create src/hooks/useAppState.ts React hook wrapping persistence. Write tests for the pure persistence functions in src/lib/__tests__/persistence.test.ts.","priority":1,"completed":true,"result":"Created src/lib/persistence.ts with pure functions: loadAppState(), saveAppState(), clearAppState(), computeStats(), defaultAppState(), defaultPuzzleState(). Schema-versioned localStorage with migration stub. Created src/hooks/useAppState.ts using useSyncExternalStore for tear-free reads. 12 tests in persistence.test.ts covering: defaults, save/load round-trip, corrupted data recovery, schema version mismatch, computeStats with empty/mixed/null-time data. All 30 tests pass.","metadata":null,"created_at":"2026-02-12T02:23:40.132Z","updated_at":"2026-02-12T02:27:38.797Z","started_at":"2026-02-12T02:27:38.796Z","completed_at":"2026-02-12T02:27:38.797Z","blockedBy":[],"blocks":[],"children":[]}
{"id":"x43emd2o","parent_id":"5v6xhkg5","name":"Puzzle data layer with parseMove and loadPuzzles","description":"Create src/lib/puzzles.ts: parseMove() to convert 'f6-g7' and 'f7-f8q' formats, parseMoves() to split multi-move solutions, loadPuzzles() to fetch and validate problems.json with Zod, getPuzzleById(). Write comprehensive tests in src/lib/__tests__/puzzles.test.ts.","priority":1,"completed":true,"result":"Created src/lib/puzzles.ts with parseMove(), parseMoves(), mateDepthFromType(), loadPuzzles() (fetches + Zod-validates problems.json), getPuzzleById(). 18 tests in puzzles.test.ts covering: standard moves, queen/knight promotions, edge squares, error cases, multi-move sequences (mate in 1/2/3), mateDepthFromType, and getPuzzleById. All pass.","metadata":null,"created_at":"2026-02-12T02:23:38.542Z","updated_at":"2026-02-12T02:27:36.548Z","started_at":"2026-02-12T02:27:36.547Z","completed_at":"2026-02-12T02:27:36.548Z","blockedBy":[],"blocks":[],"children":[]}
{"id":"zjpda3at","parent_id":"5v6xhkg5","name":"Vite + React + TypeScript project scaffolding","description":"Create package.json, index.html, tsconfig, vite.config.ts, vitest setup, and install all dependencies. Set up strict TS config. Install: react, react-dom, @lichess-org/chessground, chess.js, zod (for runtime-safe puzzle data parsing). Dev deps: vite, @vitejs/plugin-react, typescript, vitest, @testing-library/react, @testing-library/jest-dom, happy-dom.","priority":1,"completed":true,"result":"Scaffolded Vite 7.3 + React 19 + TypeScript 5.9 project. Strict tsconfig with noUncheckedIndexedAccess, exactOptionalPropertyTypes, verbatimModuleSyntax. Vitest 4.0 with happy-dom for testing. Path aliases (@/) configured. Dependencies: react, react-dom, @lichess-org/chessground, chess.js, zod. Dev build and tsc --noEmit both pass.","metadata":null,"created_at":"2026-02-12T02:23:35.284Z","updated_at":"2026-02-12T02:27:29.342Z","started_at":"2026-02-12T02:27:29.341Z","completed_at":"2026-02-12T02:27:29.342Z","blockedBy":[],"blocks":[],"children":[]}
